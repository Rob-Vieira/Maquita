class Crop{constructor({input:t,width:e=300,height:i=300,imageBeforeLoad:a=()=>{},imageAfterLoad:s=()=>{},cropEnd:r=()=>{},cropStyle:h}){this.input=document.getElementById(t),this.input.accept="image/*",this.width=e,this.height=i,this.imageBeforeLoad=a,this.imageAfterLoad=s,this.cropEnd=r,this.aspectRatio=e/i,this.cropper=null,this.isImage=!0,this.#a={imageID:this.input.id+"Image",containerStyle:{class:h.class??"",maxWidth:h.maxWidth??"500px",position:h.position??"afterend"},input:this.input},this.#b()}set #a({imageID:t,containerStyle:e,input:i}){this.continer=document.createElement("div"),""==e.class?this.continer.setAttribute("style","width: 100%;max-width: "+e.maxWidth+";overflow: hidden;"):this.continer.classList.add(e.class),this.image=document.createElement("img"),this.image.setAttribute("style","max-width: 100%;"),this.image.id=t,this.continer.appendChild(this.image),i.insertAdjacentElement("afterend",this.continer)}#b(){this.input.addEventListener("change",t=>{let e=t.target.files[0];if(e){this.imageBeforeLoad();let i=new FileReader;i.onload=t=>{if(null===t.target.result.split("base64")[0].match(/image/))this.isImage=!1,this.imageAfterLoad(!1);else{function e(t,e,i,a){let s=t.getCroppedCanvas({width:e,height:i}),r=document.createElement("canvas");r.width=e,r.height=i;r.getContext("2d").drawImage(s,0,0,s.width,s.height,0,0,e,i);a(r.toDataURL("image/webp",.8))}this.image.src=t.target.result,this.cropper&&this.cropper.destroy(),this.cropper=new Cropper(this.image,{aspectRatio:this.width/this.height,viewMode:2,cropend:()=>{e(this.cropper,this.width,this.height,this.cropEnd)},zoom:()=>{e(this.cropper,this.width,this.height,this.cropEnd)},ready:()=>{e(this.cropper,this.width,this.height,this.cropEnd)}}),this.imageAfterLoad(!0)}},i.readAsDataURL(e)}})}}class Maquita{constructor({target:t,form:e,cropClass:i}){String.prototype.hashCode=function(){var t,e,i=0;if(0===this.length)return i;for(t=0;t<this.length;t++)i=(i<<5)-i+(e=this.charCodeAt(t)),i|=0;return i},this.target=document.querySelectorAll(t),this.form=document.querySelector(e),this.crops=[],this.#c(),this.target.forEach((t,a)=>{t.id="maquita-"+e.hashCode()+a;let s=this.#d(t.dataset.name),r=this.#e(t.dataset.src);this.form.appendChild(s),this.crops.push(new Crop({input:t.id,width:t.dataset.w,height:t.dataset.h,cropStyle:{class:i??""},imageBeforeLoad:()=>{this.showLoader()},imageAfterLoad:t=>{this.hideLoader(),t&&(r.style="display: none;")},cropEnd(t){s.value=t}})),void 0!==t.dataset.src&&this.crops[a].continer.appendChild(r)})}#c(){if(null!==document.getElementById("maquita-loader"))return!1;this.styleTag=document.createElement("style"),this.styleTag.textContent="@keyframes spin {0% { transform: rotate(0deg); }100% { transform: rotate(360deg); }}.maquita-loader{border: 8px solid #f3f3f3;border-top: 8px solid #3498db;border-radius: 50%;width: 50px;height: 50px;animation: spin 2s linear infinite;position: absolute;top: 50%;left: 50%;transform: translate(-50%, -50%);}.maquita-loader.hidden{display: none;}",this.loader=document.createElement("div"),this.loader.id="maquita-loader",this.loader.classList.add("maquita-loader"),this.loader.classList.add("hidden"),document.body.append(this.styleTag,this.loader)}#d(a){let s=document.createElement("input");return s.id=a,s.name=a,s.type="hidden",s}#e(r){let h=document.createElement("img");return h.style="width: 100%;max-width: 100%;",h.src=r,h}showLoader(){document.getElementById("maquita-loader").classList.remove("hidden")}hideLoader(){document.getElementById("maquita-loader").classList.add("hidden")}}